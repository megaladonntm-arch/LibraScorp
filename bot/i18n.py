from __future__ import annotations

LANGS = ("ru", "en", "uz")

LABELS = {
    "create_presentation": {"ru": "Создать презентацию", "en": "Create presentation", "uz": "Taqdimot yaratish"},
    "my_presentations": {"ru": "Мои презентации", "en": "My presentations", "uz": "Mening taqdimotlarim"},
    "about": {"ru": "О боте", "en": "About", "uz": "Bot haqida"},
    "help": {"ru": "Помощь", "en": "Help", "uz": "Yordam"},
    "premium_section": {"ru": "Premium раздел", "en": "Premium section", "uz": "Premium bo'lim"},
    "premium_voice_chat": {"ru": "Голос -> ИИ", "en": "Voice -> AI", "uz": "Ovoz -> AI"},
    "admin_panel": {"ru": "Админ-панель", "en": "Admin panel", "uz": "Admin panel"},
    "issue_tokens": {"ru": "Выдать токены", "en": "Issue tokens", "uz": "Token berish"},
    "remove_tokens": {"ru": "Списать токены", "en": "Remove tokens", "uz": "Token yechish"},
    "check_tokens": {"ru": "Проверить токены", "en": "Check tokens", "uz": "Tokenni tekshirish"},
    "template_requests": {"ru": "Заявки шаблонов", "en": "Template requests", "uz": "Shablon so'rovlari"},
    "all_users": {"ru": "Все пользователи", "en": "All users", "uz": "Barcha foydalanuvchilar"},
    "event_logs": {"ru": "Логи сообщений", "en": "Message logs", "uz": "Xabar loglari"},
    "premium_add": {"ru": "Премиум +", "en": "Premium +", "uz": "Premium +"},
    "premium_remove": {"ru": "Премиум -", "en": "Premium -", "uz": "Premium -"},
    "premium_list": {"ru": "Премиум список", "en": "Premium list", "uz": "Premium ro'yxat"},
    "ban_user": {"ru": "Бан пользователя", "en": "Ban user", "uz": "Foydalanuvchini ban qilish"},
    "unban_user": {"ru": "Разбан пользователя", "en": "Unban user", "uz": "Bandan chiqarish"},
    "broadcast_all": {"ru": "Рассылка всем", "en": "Broadcast all", "uz": "Barchaga yuborish"},
    "user_profile": {"ru": "Профиль пользователя", "en": "User profile", "uz": "Foydalanuvchi profili"},
    "create_template_from_scratch": {"ru": "Создать шаблон с нуля", "en": "Create template from scratch", "uz": "Noldan shablon yaratish"},
    "to_menu": {"ru": "В меню", "en": "To menu", "uz": "Menyuga"},
    "language": {"ru": "Язык", "en": "Language", "uz": "Til"},
    "choose_ru": {"ru": "Русский", "en": "Russian", "uz": "Rus tili"},
    "choose_en": {"ru": "Английский", "en": "English", "uz": "Ingliz tili"},
    "choose_uz": {"ru": "Узбекский", "en": "Uzbek", "uz": "O'zbek tili"},
}

COLORS = {
    "black": {"hex": "#000000", "ru": "Черный", "en": "Black", "uz": "Qora"},
    "white": {"hex": "#FFFFFF", "ru": "Белый", "en": "White", "uz": "Oq"},
    "red": {"hex": "#FF0000", "ru": "Красный", "en": "Red", "uz": "Qizil"},
    "blue": {"hex": "#0066FF", "ru": "Синий", "en": "Blue", "uz": "Ko'k"},
    "green": {"hex": "#00AA55", "ru": "Зеленый", "en": "Green", "uz": "Yashil"},
    "yellow": {"hex": "#FFD700", "ru": "Желтый", "en": "Yellow", "uz": "Sariq"},
    "orange": {"hex": "#FF8C00", "ru": "Оранжевый", "en": "Orange", "uz": "To'q sariq"},
    "purple": {"hex": "#8A2BE2", "ru": "Фиолетовый", "en": "Purple", "uz": "Binafsha"},
}

TEXTS = {
    "ru": {
        "welcome": "Добро пожаловать в LibraScorp Presentation Studio.\n\nСобираю презентации коммерческого уровня: сильная структура, чистый дизайн и готовый .pptx за пару шагов.\n\nНажмите «Создать презентацию» или используйте /presentation.",
        "help": "Как быстро получить качественную презентацию:\n1. Нажмите «Создать презентацию».\n2. Выберите число слайдов (1-30).\n3. Выберите дизайн-комбо или сохраните свое.\n4. Укажите шрифт и цвет текста.\n5. Отправьте тему.\n6. Опционально добавьте источник: текст, ссылку или файл.\n\nРезультат:\n- Готовый .pptx с AI-контентом, адаптированным под выбранный стиль.\n- 1 генерация = 1 токен.\n\nСлужебные команды:\n- /presentation — быстрый запуск\n- /cancel — отмена текущего шага",
        "about": "LibraScorp Presentation Studio — AI-сервис для сборки презентаций в коммерческом стиле: структурированные слайды, шаблоны, брендинговые настройки текста и экспорт в .pptx.",
        "tokens_info": "Ваши токены: {tokens}",
        "generation_cancelled": "Генерация отменена.",
        "access_denied": "Доступ запрещен.",
        "admin_panel": "Панель администратора.",
        "main_menu": "Главное меню.",
        "ask_target_user_id": "Введите ID пользователя, которому выдать токены.",
        "ask_remove_target_user_id": "Введите ID пользователя, у которого нужно списать токены.",
        "id_must_number": "ID должен быть числом.",
        "ask_token_amount": "Введите количество токенов для начисления.",
        "ask_remove_token_amount": "Введите количество токенов для списания.",
        "amount_must_int": "Количество должно быть целым положительным числом.",
        "amount_gt_zero": "Количество должно быть больше нуля.",
        "tokens_added": "Пользователю {user_id} начислено {amount} токенов. Текущий баланс: {balance}.",
        "tokens_removed": "У пользователя {user_id} списано {amount} токенов. Текущий баланс: {balance}.",
        "ask_check_user_id": "Введите ID пользователя для проверки баланса.",
        "user_tokens": "Пользователь {user_id}: {tokens} токенов.",
        "premium_add_usage": "Формат: /premium_add &lt;user_id&gt;",
        "premium_remove_usage": "Формат: /premium_remove &lt;user_id&gt;",
        "premium_added": "Пользователь {user_id} добавлен в премиум.",
        "premium_already": "Пользователь {user_id} уже в премиуме.",
        "premium_removed": "Пользователь {user_id} удален из премиума.",
        "premium_not_found": "Пользователь {user_id} не найден в премиуме.",
        "premium_list_empty": "Список премиум-пользователей пуст.",
        "premium_list_title": "Премиум-пользователи ({count}):",
        "ban_usage": "Формат: /ban &lt;user_id&gt; [причина]",
        "unban_usage": "Формат: /unban &lt;user_id&gt;",
        "user_profile_usage": "Формат: /user_profile &lt;user_id&gt;",
        "ask_ban_user_id": "Введите ID пользователя для бана.",
        "ask_ban_reason": "Введите причину бана (или отправьте '-' для причины по умолчанию).",
        "ask_unban_user_id": "Введите ID пользователя для разбана.",
        "ask_profile_user_id": "Введите ID пользователя для просмотра профиля.",
        "user_banned": "Пользователь {user_id} заблокирован.",
        "user_ban_updated": "Бан пользователя {user_id} обновлен.",
        "user_unbanned": "Пользователь {user_id} разблокирован.",
        "user_not_banned": "Пользователь {user_id} не находится в бане.",
        "ban_default_reason": "Нарушение правил.",
        "banned_notice": "Вы заблокированы администратором.\nПричина: {reason}",
        "broadcast_prompt": "Отправьте текст для рассылки всем пользователям.",
        "broadcast_started": "Запускаю рассылку...",
        "broadcast_finished": "Рассылка завершена.\nОтправлено: {sent}\nОшибок: {failed}\nВсего получателей: {total}",
        "all_users_profiles_title": "Пользователи с профилями ({count}):",
        "user_profile_not_found": "Профиль пользователя {user_id} не найден.",
        "user_profile_title": "Профиль пользователя {user_id}",
        "premium_only_voice": "Эта функция доступна только премиум-пользователям, назначенным админом.",
        "premium_section_denied": "Этот раздел доступен только премиум-пользователям, назначенным админом.",
        "premium_section_opened": "Премиум-раздел открыт.",
        "premium_section_hint": "Отправьте голосовое сообщение, и я превращу его в текст, отправлю в ИИ и верну ответ.",
        "premium_send_voice_prompt": "Отправьте голосовое сообщение для диалога с ИИ.",
        "premium_voice_processing": "Принял голосовое. Распознаю текст и отправляю его в ИИ...",
        "premium_voice_transcript": "Распознанный текст:\n{text}",
        "premium_voice_answer": "Ответ ИИ:\n{text}",
        "premium_missing_openrouter_key": "Не настроен OPENROUTER_API_KEY для ответа ИИ.",
        "premium_transcription_failed": "Не удалось распознать голосовое сообщение.",
        "premium_ai_failed": "Не удалось получить ответ ИИ.",
        "template_requests_title": "Заявки на общий шаблон ({count}):",
        "template_requests_empty": "Заявок на общий шаблон пока нет.",
        "all_users_title": "Пользователи ({count}):",
        "all_users_empty": "Пользователи пока отсутствуют.",
        "event_logs_title": "Последние сообщения ({count}):",
        "event_logs_empty": "Логи пока пусты.",
        "no_tokens": "У вас закончились токены. Обратитесь к администратору.",
        "rate_limit_exceeded": "Слишком много запросов. Подождите {wait} сек. и повторите.",
        "ask_slide_count": "Сколько слайдов нужно? Введите число от 1 до 30.\nВаши токены: {tokens}",
        "slide_count_number": "Введите количество слайдов числом, например: 7",
        "slide_count_range": "Количество слайдов должно быть от 1 до 30.",
        "no_templates": "Не нашёл шаблоны в папке assets_pdf. Добавьте файлы 1.png, 2.png и т.д.",
        "choose_template": "Выберите шаблон.",
        "choose_combo_title": "Выберите дизайн-комбо для презентации:",
        "choose_combo_hint": "Выберите комбо кнопкой ниже.\nЧтобы сохранить свое: new Название: 1,2,3\nДоступные шаблоны: {available}",
        "combo_pick_number": "Выберите комбо кнопкой ниже или отправьте в формате: new Название: 1,2,3",
        "combo_tab_default": "Базовые",
        "combo_tab_global": "Общие",
        "combo_tab_my": "Мои",
        "combo_selected": "Комбо выбрано: {name}",
        "combo_new_format": "Формат сохранения: new Название: 1,2,3",
        "combo_name_short": "Название комбо слишком короткое.",
        "combo_invalid_sequence": "Некорректная последовательность. Используйте только доступные номера через запятую.",
        "combo_saved": "Комбо «{name}» сохранено и выбрано.",
        "template_preview_missing": "Превью шаблона {template} не найдено.",
        "ask_custom_template_name": "Введите название нового шаблона (минимум 2 символа).",
        "ask_custom_template_photos": "Отправляйте фото по одному. Когда закончите, отправьте: готово",
        "custom_template_need_photo": "Нужно отправить хотя бы одно фото.",
        "custom_template_photo_saved": "Фото сохранено как шаблон #{template_num}. Можно отправить еще или написать: готово",
        "custom_template_created": "Шаблон «{name}» сохранен.\nНомера: {templates}\nОн добавлен в общий список и доступен всем.",
        "custom_template_admin_notice": "Новая заявка на общий шаблон\nПользователь: {user_id}\nНазвание: {name}\nШаблоны: {templates}",
        "template_number": "Введите номер шаблона цифрой, например: 1",
        "template_missing": "Шаблона {value} нет. Доступно: {available}",
        "ask_font": "Введите название шрифта или выберите кнопкой.",
        "invalid_font": "Введите корректное название шрифта.",
        "ask_color": "Выберите готовый цвет текста кнопкой.",
        "invalid_color": "Выберите цвет из кнопок.",
        "ask_template_color": "🎨 Выбери цвет для шаблона (1-5):",
        "template_color_blue": "Blue",
        "template_color_purple": "Purple",
        "template_color_red": "Red",
        "template_color_orange": "Orange",
        "template_color_green": "Green",
        "ask_topic": "Теперь отправьте тему презентации.",
        "ask_source_material": "Основной источник берется из русской Википедии автоматически.\nМожно добавить доп. источник: текст, ссылку или .txt/.md/.csv/.json/.log файл.\nЕсли не нужно, отправьте: skip",
        "ask_creator_names": "Укажите имя автора или имена создателей презентации.\nМожно через запятую.\nЕсли не нужно, отправьте: skip",
        "ask_slide_images": "Теперь можно добавить свои фото на слайды.\nОтправляйте изображения по одному (до {max_count} шт.).\nЕсли фото не нужны: skip\nКогда закончите: done",
        "creator_slide_title": "Создатели презентации",
        "source_invalid_input": "Отправьте текст, ссылку или поддерживаемый файл.",
        "source_file_too_large": "Файл слишком большой. Максимум 2 МБ.",
        "source_file_type_unsupported": "Неподдерживаемый тип файла. Разрешено: {exts}",
        "source_url_fetch_error": "Не удалось получить текст по ссылке. Проверьте URL или отправьте текст/файл.",
        "slide_images_invalid_input": "Отправьте фото (или изображение-файл), либо введите skip/done.",
        "slide_images_file_too_large": "Изображение слишком большое. Максимум 10 МБ.",
        "slide_images_file_type_unsupported": "Неподдерживаемый формат изображения. Разрешено: {exts}",
        "slide_images_too_small": "Изображение слишком маленькое. Минимум: {min_w}x{min_h} px.",
        "slide_images_download_failed": "Не удалось обработать изображение. Попробуйте другое фото.",
        "slide_images_photo_saved": "Фото добавлено: {current}/{max_count}. Можно отправить еще или написать done.",
        "slide_images_limit_reached": "Достигнут лимит {max_count} фото. Начинаю генерацию презентации.",
        "action_expired_retry": "Действие устарело. Начните заново из текущего меню.",
        "flow_expired_restart": "Сессия генерации устарела. Запустите заново: /presentation",
        "topic_short": "Тема слишком короткая. Напишите чуть подробнее.",
        "generating": "Генерирую текст и собираю презентацию, это может занять до минуты...",
        "ready": "Готово.\nСлайдов: {slides}\nШрифт: {font}\nЦвет: {color}\nТокенов осталось: {tokens}",
        "build_error": "Ошибка при создании презентации: {error}",
        "my_tokens": "У вас {tokens} токенов.",
        "my_presentations_empty": "У вас пока нет сохраненных презентаций.",
        "my_presentations_title": "Последние презентации:",
        "my_combos_empty": "У вас пока нет сохраненных комбо.",
        "my_combos_title": "Ваши комбо шаблонов:",
        "choose_language": "Выберите язык.",
        "language_changed": "Язык изменен.",
    },
    "en": {
        "welcome": "Welcome to LibraScorp Presentation Studio.\n\nBuild commercial-grade presentations with structured AI content, polished design, and ready-to-send .pptx output.\n\nPress \"Create presentation\" or run /presentation.",
        "help": "How to generate a premium presentation fast:\n1. Press \"Create presentation\".\n2. Select slide count (1-30).\n3. Choose a design combo or save your custom one.\n4. Select font and text color.\n5. Send your topic.\n6. Optionally provide source material: text, URL, or file.\n\nOutput:\n- A ready .pptx with high-quality AI slide content.\n- 1 generation = 1 token.\n\nService commands:\n- /presentation — quick start\n- /cancel — cancel current flow",
        "about": "LibraScorp Presentation Studio is an AI-powered presentation builder focused on commercial quality: structured messaging, template-driven visuals, brand-safe text settings, and .pptx delivery.",
        "tokens_info": "Your tokens: {tokens}",
        "generation_cancelled": "Generation canceled.",
        "access_denied": "Access denied.",
        "admin_panel": "Admin panel.",
        "main_menu": "Main menu.",
        "ask_target_user_id": "Enter user ID to issue tokens.",
        "ask_remove_target_user_id": "Enter user ID to remove tokens from.",
        "id_must_number": "ID must be a number.",
        "ask_token_amount": "Enter token amount to add.",
        "ask_remove_token_amount": "Enter token amount to remove.",
        "amount_must_int": "Amount must be a positive integer.",
        "amount_gt_zero": "Amount must be greater than zero.",
        "tokens_added": "Added {amount} tokens to user {user_id}. Current balance: {balance}.",
        "tokens_removed": "Removed {amount} tokens from user {user_id}. Current balance: {balance}.",
        "ask_check_user_id": "Enter user ID to check balance.",
        "user_tokens": "User {user_id}: {tokens} tokens.",
        "premium_add_usage": "Format: /premium_add &lt;user_id&gt;",
        "premium_remove_usage": "Format: /premium_remove &lt;user_id&gt;",
        "premium_added": "User {user_id} has been added to premium.",
        "premium_already": "User {user_id} is already premium.",
        "premium_removed": "User {user_id} has been removed from premium.",
        "premium_not_found": "User {user_id} is not in premium list.",
        "premium_list_empty": "Premium users list is empty.",
        "premium_list_title": "Premium users ({count}):",
        "ban_usage": "Format: /ban &lt;user_id&gt; [reason]",
        "unban_usage": "Format: /unban &lt;user_id&gt;",
        "user_profile_usage": "Format: /user_profile &lt;user_id&gt;",
        "ask_ban_user_id": "Enter user ID to ban.",
        "ask_ban_reason": "Enter ban reason (or send '-' for default reason).",
        "ask_unban_user_id": "Enter user ID to unban.",
        "ask_profile_user_id": "Enter user ID to view profile.",
        "user_banned": "User {user_id} has been banned.",
        "user_ban_updated": "Ban for user {user_id} has been updated.",
        "user_unbanned": "User {user_id} has been unbanned.",
        "user_not_banned": "User {user_id} is not banned.",
        "ban_default_reason": "Violation of rules.",
        "banned_notice": "You are blocked by admin.\nReason: {reason}",
        "broadcast_prompt": "Send text to broadcast to all users.",
        "broadcast_started": "Starting broadcast...",
        "broadcast_finished": "Broadcast finished.\nSent: {sent}\nFailed: {failed}\nTotal recipients: {total}",
        "all_users_profiles_title": "Users with profiles ({count}):",
        "user_profile_not_found": "Profile for user {user_id} not found.",
        "user_profile_title": "User profile {user_id}",
        "premium_only_voice": "This feature is only available for premium users assigned by admin.",
        "premium_section_denied": "This section is available only for premium users assigned by admin.",
        "premium_section_opened": "Premium section opened.",
        "premium_section_hint": "Send a voice message, and I will convert it to text, send it to AI, and return the answer.",
        "premium_send_voice_prompt": "Send a voice message to chat with AI.",
        "premium_voice_processing": "Voice received. Transcribing and sending to AI...",
        "premium_voice_transcript": "Transcribed text:\n{text}",
        "premium_voice_answer": "AI answer:\n{text}",
        "premium_missing_openrouter_key": "OPENROUTER_API_KEY is not configured for AI replies.",
        "premium_transcription_failed": "Failed to transcribe voice message.",
        "premium_ai_failed": "Failed to get AI response.",
        "template_requests_title": "Template requests ({count}):",
        "template_requests_empty": "No template requests yet.",
        "all_users_title": "Users ({count}):",
        "all_users_empty": "No users yet.",
        "event_logs_title": "Recent messages ({count}):",
        "event_logs_empty": "No logs yet.",
        "no_tokens": "You have no tokens left. Contact admin.",
        "rate_limit_exceeded": "Too many requests. Please wait {wait} seconds and try again.",
        "ask_slide_count": "How many slides do you need? Enter 1 to 30.\nYour tokens: {tokens}",
        "slide_count_number": "Enter slide count as a number, for example: 7",
        "slide_count_range": "Slide count must be from 1 to 30.",
        "no_templates": "No templates found in assets_pdf. Add files like 1.png, 2.png.",
        "choose_template": "Choose template.",
        "choose_combo_title": "Choose a presentation design combo:",
        "choose_combo_hint": "Pick a combo using the buttons below.\nTo save your own: new Name: 1,2,3\nAvailable templates: {available}",
        "combo_pick_number": "Pick a combo using the buttons below, or send: new Name: 1,2,3",
        "combo_tab_default": "Default",
        "combo_tab_global": "Global",
        "combo_tab_my": "My",
        "combo_selected": "Selected combo: {name}",
        "combo_new_format": "Save format: new Name: 1,2,3",
        "combo_name_short": "Combo name is too short.",
        "combo_invalid_sequence": "Invalid sequence. Use only available template numbers separated by commas.",
        "combo_saved": "Combo \"{name}\" saved and selected.",
        "template_preview_missing": "Template preview {template} not found.",
        "ask_custom_template_name": "Enter a new template name (at least 2 chars).",
        "ask_custom_template_photos": "Send photos one by one. When done, send: done",
        "custom_template_need_photo": "Send at least one photo.",
        "custom_template_photo_saved": "Photo saved as template #{template_num}. Send more photos or type: done",
        "custom_template_created": "Template \"{name}\" saved.\nNumbers: {templates}\nIt was added to global templates for everyone.",
        "custom_template_admin_notice": "New global template request\nUser: {user_id}\nName: {name}\nTemplates: {templates}",
        "template_number": "Enter template number, for example: 1",
        "template_missing": "Template {value} not found. Available: {available}",
        "ask_font": "Enter font name or choose a button.",
        "invalid_font": "Enter a valid font name.",
        "ask_color": "Choose a ready text color using buttons.",
        "invalid_color": "Choose a color from buttons.",
        "ask_template_color": "🎨 Choose template color (1-5):",
        "template_color_blue": "Blue",
        "template_color_purple": "Purple",
        "template_color_red": "Red",
        "template_color_orange": "Orange",
        "template_color_green": "Green",
        "ask_topic": "Now send presentation topic.",
        "ask_source_material": "The main source is fetched automatically from Russian Wikipedia.\nYou can add extra material: text, link, or a .txt/.md/.csv/.json/.log file.\nIf you want to skip, send: skip",
        "ask_creator_names": "Enter author name or presentation creators.\nYou can send multiple names separated by commas.\nIf you want to skip, send: skip",
        "ask_slide_images": "You can now add your own slide photos.\nSend images one by one (up to {max_count}).\nIf not needed: skip\nWhen finished: done",
        "creator_slide_title": "Presentation creators",
        "source_invalid_input": "Send text, link, or a supported file.",
        "source_file_too_large": "The file is too large. Maximum size is 2 MB.",
        "source_file_type_unsupported": "Unsupported file type. Allowed: {exts}",
        "source_url_fetch_error": "Could not fetch text from the link. Check URL or send text/file instead.",
        "slide_images_invalid_input": "Send a photo (or image file), or type skip/done.",
        "slide_images_file_too_large": "Image is too large. Maximum size is 10 MB.",
        "slide_images_file_type_unsupported": "Unsupported image type. Allowed: {exts}",
        "slide_images_too_small": "Image is too small. Minimum: {min_w}x{min_h} px.",
        "slide_images_download_failed": "Failed to process image. Please send another photo.",
        "slide_images_photo_saved": "Photo added: {current}/{max_count}. Send more or type done.",
        "slide_images_limit_reached": "Reached the limit of {max_count} photos. Starting generation.",
        "action_expired_retry": "This action has expired. Start again from the current menu.",
        "flow_expired_restart": "Generation session has expired. Start again with: /presentation",
        "topic_short": "Topic is too short. Please provide more details.",
        "generating": "Generating text and building presentation, this may take up to a minute...",
        "ready": "Done.\nSlides: {slides}\nFont: {font}\nColor: {color}\nTokens left: {tokens}",
        "build_error": "Failed to create presentation: {error}",
        "my_tokens": "You have {tokens} tokens.",
        "my_presentations_empty": "You do not have saved presentations yet.",
        "my_presentations_title": "Your recent presentations:",
        "my_combos_empty": "You have no saved combos yet.",
        "my_combos_title": "Your template combos:",
        "choose_language": "Choose language.",
        "language_changed": "Language updated.",
    },
    "uz": {
        "welcome": "LibraScorp Presentation Studio'ga xush kelibsiz.\n\nBot sizga tijoriy darajadagi taqdimotlarni tez yaratishda yordam beradi: kuchli struktura, toza dizayn va tayyor .pptx.\n\nBoshlash uchun \"Taqdimot yaratish\" tugmasini bosing yoki /presentation yuboring.",
        "help": "Premium taqdimotni tez yaratish tartibi:\n1. \"Taqdimot yaratish\" tugmasini bosing.\n2. Slayd sonini tanlang (1-30).\n3. Dizayn komboni tanlang yoki o'zingiznikini saqlang.\n4. Shrift va matn rangini tanlang.\n5. Mavzuni yuboring.\n6. Ixtiyoriy: manba qo'shing (matn, havola yoki fayl).\n\nNatija:\n- AI asosida sifatli kontentli tayyor .pptx.\n- 1 taqdimot = 1 token.\n\nXizmat buyruqlari:\n- /presentation — tez boshlash\n- /cancel — joriy bosqichni bekor qilish",
        "about": "LibraScorp Presentation Studio — AI yordamida tijoriy uslubdagi taqdimotlar yaratish xizmati: strukturali slayd matnlari, shablon asosida dizayn va .pptx formatida tayyor eksport.",
        "tokens_info": "Tokenlaringiz: {tokens}",
        "generation_cancelled": "Yaratish bekor qilindi.",
        "access_denied": "Ruxsat yo'q.",
        "admin_panel": "Admin panel.",
        "main_menu": "Asosiy menyu.",
        "ask_target_user_id": "Token berish uchun foydalanuvchi ID sini kiriting.",
        "ask_remove_target_user_id": "Token yechish uchun foydalanuvchi ID sini kiriting.",
        "id_must_number": "ID raqam bo'lishi kerak.",
        "ask_token_amount": "Qo'shiladigan token sonini kiriting.",
        "ask_remove_token_amount": "Yechiladigan token sonini kiriting.",
        "amount_must_int": "Soni musbat butun son bo'lishi kerak.",
        "amount_gt_zero": "Soni noldan katta bo'lishi kerak.",
        "tokens_added": "{user_id} foydalanuvchiga {amount} token qo'shildi. Joriy balans: {balance}.",
        "tokens_removed": "{user_id} foydalanuvchidan {amount} token yechildi. Joriy balans: {balance}.",
        "ask_check_user_id": "Balansni tekshirish uchun foydalanuvchi ID sini kiriting.",
        "user_tokens": "Foydalanuvchi {user_id}: {tokens} token.",
        "premium_add_usage": "Format: /premium_add &lt;user_id&gt;",
        "premium_remove_usage": "Format: /premium_remove &lt;user_id&gt;",
        "premium_added": "{user_id} foydalanuvchi premiumga qo'shildi.",
        "premium_already": "{user_id} foydalanuvchi allaqachon premiumda.",
        "premium_removed": "{user_id} foydalanuvchi premiumdan olib tashlandi.",
        "premium_not_found": "{user_id} foydalanuvchi premium ro'yxatda yo'q.",
        "premium_list_empty": "Premium foydalanuvchilar ro'yxati bo'sh.",
        "premium_list_title": "Premium foydalanuvchilar ({count}):",
        "ban_usage": "Format: /ban &lt;user_id&gt; [sabab]",
        "unban_usage": "Format: /unban &lt;user_id&gt;",
        "user_profile_usage": "Format: /user_profile &lt;user_id&gt;",
        "ask_ban_user_id": "Ban qilish uchun foydalanuvchi ID sini kiriting.",
        "ask_ban_reason": "Ban sababini kiriting (yoki '-' yuboring).",
        "ask_unban_user_id": "Bandan chiqarish uchun foydalanuvchi ID sini kiriting.",
        "ask_profile_user_id": "Profil ko'rish uchun foydalanuvchi ID sini kiriting.",
        "user_banned": "{user_id} foydalanuvchi ban qilindi.",
        "user_ban_updated": "{user_id} foydalanuvchi bani yangilandi.",
        "user_unbanned": "{user_id} foydalanuvchi bandan chiqarildi.",
        "user_not_banned": "{user_id} foydalanuvchi banda emas.",
        "ban_default_reason": "Qoidabuzarlik.",
        "banned_notice": "Siz admin tomonidan bloklangansiz.\nSabab: {reason}",
        "broadcast_prompt": "Barcha foydalanuvchilarga yuboriladigan matnni yuboring.",
        "broadcast_started": "Yuborish boshlandi...",
        "broadcast_finished": "Yuborish tugadi.\nYuborildi: {sent}\nXatolik: {failed}\nJami: {total}",
        "all_users_profiles_title": "Profilga ega foydalanuvchilar ({count}):",
        "user_profile_not_found": "{user_id} foydalanuvchi profili topilmadi.",
        "user_profile_title": "{user_id} foydalanuvchi profili",
        "premium_only_voice": "Bu funksiya faqat admin tayinlagan premium foydalanuvchilar uchun.",
        "premium_section_denied": "Bu bo'lim faqat admin tayinlagan premium foydalanuvchilar uchun.",
        "premium_section_opened": "Premium bo'lim ochildi.",
        "premium_section_hint": "Ovozli xabar yuboring, men uni matnga aylantirib AI ga yuboraman va javobni qaytaraman.",
        "premium_send_voice_prompt": "AI bilan muloqot uchun ovozli xabar yuboring.",
        "premium_voice_processing": "Ovozli xabar olindi. Matnga aylantirib, AI ga yuboryapman...",
        "premium_voice_transcript": "Aniqlangan matn:\n{text}",
        "premium_voice_answer": "AI javobi:\n{text}",
        "premium_missing_openrouter_key": "AI javobi uchun OPENROUTER_API_KEY sozlanmagan.",
        "premium_transcription_failed": "Ovozli xabarni matnga aylantirib bo'lmadi.",
        "premium_ai_failed": "AI javobini olib bo'lmadi.",
        "template_requests_title": "Shablon so'rovlari ({count}):",
        "template_requests_empty": "Hozircha shablon so'rovlari yo'q.",
        "all_users_title": "Foydalanuvchilar ({count}):",
        "all_users_empty": "Hozircha foydalanuvchilar yo'q.",
        "event_logs_title": "Oxirgi xabarlar ({count}):",
        "event_logs_empty": "Loglar hozircha bo'sh.",
        "no_tokens": "Token tugagan. Adminga murojaat qiling.",
        "rate_limit_exceeded": "So'rovlar juda ko'p. {wait} soniya kutib, qayta urinib ko'ring.",
        "ask_slide_count": "Nechta slayd kerak? 1 dan 30 gacha kiriting.\nTokenlaringiz: {tokens}",
        "slide_count_number": "Slayd sonini raqam bilan kiriting, masalan: 7",
        "slide_count_range": "Slayd soni 1 dan 30 gacha bo'lishi kerak.",
        "no_templates": "assets_pdf papkasida shablon topilmadi. 1.png, 2.png kabi fayllar qo'shing.",
        "choose_template": "Shablonni tanlang.",
        "choose_combo_title": "Taqdimot dizayn kombosini tanlang:",
        "choose_combo_hint": "Quyidagi tugmalar orqali kombo tanlang.\nSaqlash uchun: new Nomi: 1,2,3\nMavjud shablonlar: {available}",
        "combo_pick_number": "Quyidagi tugmalar orqali kombo tanlang yoki yuboring: new Nomi: 1,2,3",
        "combo_tab_default": "Asosiy",
        "combo_tab_global": "Umumiy",
        "combo_tab_my": "Mening",
        "combo_selected": "Tanlangan kombo: {name}",
        "combo_new_format": "Saqlash formati: new Nomi: 1,2,3",
        "combo_name_short": "Kombo nomi juda qisqa.",
        "combo_invalid_sequence": "Noto'g'ri ketma-ketlik. Faqat mavjud shablon raqamlarini vergul bilan yuboring.",
        "combo_saved": "\"{name}\" kombo saqlandi va tanlandi.",
        "template_preview_missing": "{template} shablon prevyusi topilmadi.",
        "ask_custom_template_name": "Yangi shablon nomini kiriting (kamida 2 belgi).",
        "ask_custom_template_photos": "Rasmlarni bittadan yuboring. Tugagach: tayyor deb yozing",
        "custom_template_need_photo": "Kamida bitta rasm yuboring.",
        "custom_template_photo_saved": "Rasm #{template_num} sifatida saqlandi. Yana yuboring yoki: tayyor",
        "custom_template_created": "\"{name}\" shabloni saqlandi.\nRaqamlar: {templates}\nBarcha foydalanuvchilar uchun umumiy ro'yxatga qo'shildi.",
        "custom_template_admin_notice": "Yangi umumiy shablon so'rovi\nFoydalanuvchi: {user_id}\nNomi: {name}\nShablonlar: {templates}",
        "template_number": "Shablon raqamini kiriting, masalan: 1",
        "template_missing": "{value} shablon topilmadi. Mavjud: {available}",
        "ask_font": "Shrift nomini kiriting yoki tugmadan tanlang.",
        "invalid_font": "To'g'ri shrift nomini kiriting.",
        "ask_color": "Matn uchun tayyor rangni tugmadan tanlang.",
        "invalid_color": "Rangni tugmalardan tanlang.",
        "ask_template_color": "🎨 Shablon uchun rangni tanlang (1-5):",
        "template_color_blue": "Ko'k",
        "template_color_purple": "Binafsha",
        "template_color_red": "Qizil",
        "template_color_orange": "To'q sariq",
        "template_color_green": "Yashil",
        "ask_topic": "Endi taqdimot mavzusini yuboring.",
        "ask_source_material": "Asosiy manba ruscha Vikipediyadan avtomatik olinadi.\nQo'shimcha manba yuborishingiz mumkin: matn, havola yoki .txt/.md/.csv/.json/.log fayl.\nO'tkazib yuborish uchun: skip",
        "ask_creator_names": "Muallif ismini yoki taqdimot yaratuvchilar ismlarini yuboring.\nBir nechta ismni vergul bilan yuborishingiz mumkin.\nKerak bo'lmasa: skip",
        "ask_slide_images": "Endi slaydlarga o'zingizning rasmlaringizni qo'shishingiz mumkin.\nRasmlarni bittadan yuboring (maksimum {max_count} ta).\nKerak bo'lmasa: skip\nTugatgach: done",
        "creator_slide_title": "Taqdimot mualliflari",
        "source_invalid_input": "Matn, havola yoki qo'llab-quvvatlanadigan fayl yuboring.",
        "source_file_too_large": "Fayl juda katta. Maksimal hajm 2 MB.",
        "source_file_type_unsupported": "Qo'llab-quvvatlanmaydigan fayl turi. Ruxsat etilgan: {exts}",
        "source_url_fetch_error": "Havoladan matn olinmadi. URL ni tekshiring yoki matn/fayl yuboring.",
        "slide_images_invalid_input": "Rasm (yoki rasm-fayl) yuboring, yoki skip/done deb yozing.",
        "slide_images_file_too_large": "Rasm hajmi juda katta. Maksimal 10 MB.",
        "slide_images_file_type_unsupported": "Rasm formati qo'llab-quvvatlanmaydi. Ruxsat etilgan: {exts}",
        "slide_images_too_small": "Rasm juda kichik. Minimum: {min_w}x{min_h} px.",
        "slide_images_download_failed": "Rasmni qayta ishlab bo'lmadi. Boshqa rasm yuboring.",
        "slide_images_photo_saved": "Rasm qo'shildi: {current}/{max_count}. Yana yuboring yoki done deb yozing.",
        "slide_images_limit_reached": "{max_count} ta rasm limitiga yetildi. Taqdimot yaratilmoqda.",
        "action_expired_retry": "Bu amal eskirgan. Joriy menyudan qayta boshlang.",
        "flow_expired_restart": "Yaratish sessiyasi eskirdi. Qayta boshlang: /presentation",
        "topic_short": "Mavzu juda qisqa. Batafsilroq yozing.",
        "generating": "Matn yaratilmoqda va taqdimot yig'ilmoqda, bu bir daqiqagacha davom etishi mumkin...",
        "ready": "Tayyor.\nSlaydlar: {slides}\nShrift: {font}\nRang: {color}\nQolgan token: {tokens}",
        "build_error": "Taqdimot yaratishda xatolik: {error}",
        "my_tokens": "Sizda {tokens} token bor.",
        "my_presentations_empty": "Sizda hozircha saqlangan taqdimotlar yo'q.",
        "my_presentations_title": "Oxirgi taqdimotlaringiz:",
        "my_combos_empty": "Sizda hozircha saqlangan kombo yo'q.",
        "my_combos_title": "Sizning shablon kombolaringiz:",
        "choose_language": "Tilni tanlang.",
        "language_changed": "Til o'zgartirildi.",
    },
}


def normalize_lang(lang: str | None) -> str:
    return lang if lang in LANGS else "ru"


def t(lang: str, key: str, **kwargs: object) -> str:
    effective_lang = normalize_lang(lang)
    template = TEXTS[effective_lang][key]
    return template.format(**kwargs)


def label(lang: str, key: str) -> str:
    effective_lang = normalize_lang(lang)
    return LABELS[key][effective_lang]


def is_action_text(value: str | None, key: str) -> bool:
    if not value:
        return False
    normalized = value.strip().casefold()
    return normalized in {labels.casefold() for labels in LABELS[key].values()}


def detect_language(value: str | None) -> str | None:
    if not value:
        return None
    normalized = value.strip().casefold()
    mapping = {
        LABELS["choose_ru"]["ru"].casefold(): "ru",
        LABELS["choose_ru"]["en"].casefold(): "ru",
        LABELS["choose_ru"]["uz"].casefold(): "ru",
        "ru": "ru",
        "рус": "ru",
        LABELS["choose_en"]["ru"].casefold(): "en",
        LABELS["choose_en"]["en"].casefold(): "en",
        LABELS["choose_en"]["uz"].casefold(): "en",
        "en": "en",
        LABELS["choose_uz"]["ru"].casefold(): "uz",
        LABELS["choose_uz"]["en"].casefold(): "uz",
        LABELS["choose_uz"]["uz"].casefold(): "uz",
        "uz": "uz",
    }
    return mapping.get(normalized)


def color_buttons(lang: str) -> list[str]:
    effective_lang = normalize_lang(lang)
    return [COLORS[key][effective_lang] for key in COLORS]


def color_hex_by_text(value: str | None) -> tuple[str, str] | None:
    if not value:
        return None
    normalized = value.strip().casefold()
    for color in COLORS.values():
        for lang in LANGS:
            if normalized == str(color[lang]).casefold():
                return str(color["hex"]), str(color[lang])
    return None
